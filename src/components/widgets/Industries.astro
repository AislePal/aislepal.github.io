---
import type { Industries as Props } from '~/types';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import ImageCard from '~/components/ui/ImageCard.astro';
import { Icon } from 'astro-icon/components';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,
  industries = [],

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />
  <div class="max-w-full mx-auto px-6 relative overflow-x-hidden">
    <!-- Outer flex row: left arrow | scroll container | right arrow -->
    <div class="reveal-up flex items-center gap-2 text-white">
      <!-- Left button -->
      <button
        id={`scrollLeft-${id || 'industries'}`}
        class="hidden md:flex items-center justify-center bg-gray-400 dark:bg-gray-400 hover:bg-gray-500 dark:hover:bg-gray-500 rounded-full w-10 h-10 text-white transition flex-shrink-0"
        aria-label="Scroll left"
      >
        <Icon name="tabler:chevron-left" class="w-5 h-5" />
      </button>

      <!-- Scroll container -->
      <div
        id={`cardsContainer-${id || 'industries'}`}
        class="flex gap-6 overflow-x-auto scroll-smooth snap-x snap-mandatory no-scrollbar flex-1"
        style="touch-action: pan-x; overscroll-behavior-x: contain; -webkit-overflow-scrolling: touch;"
      >
        {
          industries &&
            industries.map((industry) => <ImageCard img={industry.image || ''} title={industry.name || ''} />)
        }
      </div>

      <!-- Right button -->
      <button
        id={`scrollRight-${id || 'industries'}`}
        class="hidden md:flex items-center justify-center bg-gray-400 dark:bg-gray-400 hover:bg-gray-500 dark:hover:bg-gray-500 rounded-full w-10 h-10 text-white transition flex-shrink-0"
        aria-label="Scroll right"
      >
        <Icon name="tabler:chevron-right" class="w-5 h-5" />
      </button>
    </div>
  </div>

  <script is:inline define:vars={{ widgetId: id || 'industries' }}>
    (function () {
      const containerId = `cardsContainer-${widgetId}`;
      const leftBtnId = `scrollLeft-${widgetId}`;
      const rightBtnId = `scrollRight-${widgetId}`;

      let initialized = false;

      function initIndustriesScroll() {
        if (initialized) return;

        const container = document.getElementById(containerId);
        const leftBtn = document.getElementById(leftBtnId);
        const rightBtn = document.getElementById(rightBtnId);

        if (!container || !leftBtn || !rightBtn) return;

        initialized = true;

        const cardWidth = 300; // min-w-[300px]
        const gap = 24; // gap-6 = 24px
        const scrollAmount = cardWidth + gap;

        leftBtn.addEventListener('click', () => {
          container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        });

        rightBtn.addEventListener('click', () => {
          container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        });

        // Update button visibility based on scroll position
        const updateButtons = () => {
          const { scrollLeft, scrollWidth, clientWidth } = container;
          const isAtStart = scrollLeft <= 10;
          const isAtEnd = scrollLeft >= scrollWidth - clientWidth - 10;

          leftBtn.style.opacity = isAtStart ? '0.5' : '1';
          leftBtn.style.pointerEvents = isAtStart ? 'none' : 'auto';
          rightBtn.style.opacity = isAtEnd ? '0.5' : '1';
          rightBtn.style.pointerEvents = isAtEnd ? 'none' : 'auto';
        };

        container.addEventListener('scroll', updateButtons);
        updateButtons();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initIndustriesScroll);
      } else {
        initIndustriesScroll();
      }

      document.addEventListener('astro:after-swap', function () {
        initialized = false;
        initIndustriesScroll();
      });
    })();
  </script>
</WidgetWrapper>
